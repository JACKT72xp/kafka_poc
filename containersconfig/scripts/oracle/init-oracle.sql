
-- Script para crear usuario y tabla de prueba en Oracle

-- Crear el usuario si no existe
BEGIN
   EXECUTE IMMEDIATE 'CREATE USER APP_USER IDENTIFIED BY app_password';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -01920 THEN
         RAISE;
      END IF;
END;
/

-- Otorgar privilegios al usuario
BEGIN
   EXECUTE IMMEDIATE 'GRANT CONNECT, RESOURCE TO APP_USER';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -01921 THEN
         RAISE;
      END IF;
END;
/

-- Conectarse al usuario
ALTER SESSION SET CURRENT_SCHEMA = APP_USER;

-- Crear tabla si no existe
BEGIN
   EXECUTE IMMEDIATE '
      CREATE TABLE CUSTOMERS_HISTORY (
         ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
         NAME VARCHAR2(100),
         EMAIL VARCHAR2(100),
         CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
         SYNCED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -955 THEN
         RAISE;
      END IF;
END;
/
